# 時間變動性解決方案

## 問題分析

原始需求明確指出時間應該是動態的：
- 「如果沒有著名指定的的日期則以今天為主」
- 「15 天內的科技新聞或報告內容，指科技新聞或報告發布日期是從今天算起 15 天內的文章內容」

## 解決方案設計

### 1. 動態時間變數系統

#### 基本變數定義
```
{TODAY}           = 執行當天日期 (YYYY-MM-DD 格式)
{DAYS_RANGE}      = 15 (可調整的天數範圍)
{START_DATE}      = {TODAY} - {DAYS_RANGE} 天
{END_DATE}        = {TODAY}
{CURRENT_YEAR}    = 執行當年 (YYYY 格式)
{CURRENT_MONTH}   = 執行當月 (MM 格式)
{LAST_MONTH}      = 上個月 (MM 格式)
```

#### 進階時間變數
```
{WEEK_START}      = 本週開始日期 (週一)
{WEEK_END}        = 本週結束日期 (週日)
{MONTH_START}     = 本月開始日期
{MONTH_END}       = 本月結束日期
{QUARTER_START}   = 本季開始日期
{QUARTER_END}     = 本季結束日期
```

### 2. 搜尋查詢動態化

#### 原本的固定查詢
```
"OpenAI" 新聞 2025年7月 OR 2025年8月
```

#### 改為動態查詢
```
"OpenAI" 新聞 {CURRENT_YEAR}年{CURRENT_MONTH}月 OR {CURRENT_YEAR}年{LAST_MONTH}月
"OpenAI" 新聞 after:{START_DATE} before:{END_DATE}
"OpenAI" 新聞 最近{DAYS_RANGE}天
```

### 3. 時間範圍配置系統

#### 可調整的時間配置
```json
{
  "time_config": {
    "default_range_days": 15,
    "alternative_ranges": {
      "short_term": 7,
      "medium_term": 30,
      "long_term": 90
    },
    "date_formats": {
      "iso": "YYYY-MM-DD",
      "chinese": "YYYY年MM月DD日",
      "search_friendly": "YYYY/MM/DD"
    }
  }
}
```

### 4. 多語言時間表達

#### 中文時間表達
```
最近{DAYS_RANGE}天
{CURRENT_YEAR}年{CURRENT_MONTH}月
本週
本月
近期
最新
```

#### 英文時間表達
```
last {DAYS_RANGE} days
{CURRENT_YEAR}-{CURRENT_MONTH}
this week
this month
recent
latest
```

### 5. 實作範例

#### 動態搜尋指令模板
```
SEARCH "{KEYWORD}" 新聞 最近{DAYS_RANGE}天 SITES "{TARGET_SITES}" FOCUS "{FOCUS_AREAS}" TYPE "keyword_search" ID "{TASK_ID}"

SEARCH "{KEYWORD}" news last {DAYS_RANGE} days SITES "{TARGET_SITES}" FOCUS "{FOCUS_AREAS}" TYPE "keyword_search" ID "{TASK_ID}"

SEARCH "{KEYWORD}" after:{START_DATE} before:{END_DATE} SITES "{TARGET_SITES}" FOCUS "{FOCUS_AREAS}" TYPE "keyword_search" ID "{TASK_ID}"
```

#### 動態過濾規則
```json
{
  "filter_rules": {
    "date_range": {
      "start": "{START_DATE}",
      "end": "{END_DATE}",
      "format": "YYYY-MM-DD"
    },
    "time_expressions": [
      "最近{DAYS_RANGE}天",
      "{CURRENT_YEAR}年{CURRENT_MONTH}月",
      "本週",
      "本月",
      "近期",
      "最新"
    ]
  }
}
```

### 6. 執行時變數替換機制

#### 執行前處理
1. 獲取當前日期和時間
2. 計算所有動態變數的值
3. 替換模板中的所有變數
4. 生成最終的執行指令

#### 變數替換範例
```
原始模板: SEARCH "OpenAI" 新聞 最近{DAYS_RANGE}天
執行時間: 2025-08-09
替換結果: SEARCH "OpenAI" 新聞 最近15天

原始模板: {START_DATE} to {END_DATE}
執行時間: 2025-08-09
替換結果: 2025-07-25 to 2025-08-09
```

### 7. 彈性配置選項

#### 使用者可調整參數
```json
{
  "user_config": {
    "time_range_days": 15,        // 可調整為 7, 15, 30, 90
    "include_weekends": true,     // 是否包含週末
    "business_days_only": false,  // 是否僅工作日
    "timezone": "Asia/Taipei",    // 時區設定
    "date_format_preference": "chinese"  // 日期格式偏好
  }
}
```

### 8. 錯誤處理和備用方案

#### 時間計算錯誤處理
```
如果 {START_DATE} 計算錯誤 → 使用固定 15 天前
如果 {TODAY} 獲取失敗 → 使用系統預設日期
如果時區轉換失敗 → 使用 UTC 時間
```

#### 備用搜尋策略
```
主要策略: 使用精確日期範圍
備用策略1: 使用相對時間表達 ("最近15天")
備用策略2: 使用月份表達 ("2025年8月")
備用策略3: 使用通用時間詞 ("最新", "近期")
```

## 實作建議

1. **優先實作動態變數系統**
2. **提供多種時間表達方式**
3. **加入使用者可調整的配置**
4. **建立完整的錯誤處理機制**
5. **支援多語言和多時區**

